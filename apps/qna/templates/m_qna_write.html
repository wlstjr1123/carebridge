{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="icon" href="{% static 'core/img/favicon.png' %}" type="image/png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QnA 작성 - CareBridge</title>
  <link rel="stylesheet" href="{% static 'qna/css/m_qna_common.css' %}">
  <link rel="stylesheet" href="{% static 'qna/css/m_qna_write.css' %}">
  <link rel="stylesheet" href="{% static 'core/css/footer.css' %}">
</head>
<body class="has-footer">
  {% include "core/_header.html" %}
  
  <main class="qna-main">
    <div class="qna-container">
      <div class="qna-header">
        <h1>QnA 작성</h1>
        <a href="{% url 'qna:qna_list' %}" class="btn-list">목록으로</a>
      </div>

      {% if error %}
        <div class="qna-error">
          <p>{{ error }}</p>
        </div>
      {% endif %}

      <form method="post" action="{% url 'qna:qna_write' %}" class="qna-form">
        {% csrf_token %}
        
        <!-- 개인정보 수집·이용 동의 (CareBridge) -->
        <div class="form-group">
          <div class="terms-section">
            <div class="terms-header">
              <h2 class="terms-title">개인정보수집 및 이용동의 (필수)</h2>
            </div>

            <div class="terms-box">
              <h3>1. 개인정보 수집 목적</h3>
              <ul>
                <li>회원 가입 및 본인 식별 (계정 생성, 로그인)</li>
                <li>의사 인증 및 병원 소속 확인 (의사 면허번호, 진료과, 소속 병원 정보 확인)</li>
                <li>병원·의사 기능 제공 (환자 관리, 진료·검사·처치 기록 확인, 진료 일정 및 예약 관리)</li>
                <li>고객 문의 처리 및 공지사항 안내</li>
                <li>서비스 운영 및 보안 관리 (부정 이용 방지, 로그 분석 및 오류 대응)</li>
              </ul>

              <h3>2. 수집하는 개인정보 항목</h3>

              <h4>① 공통 수집 항목 (회원가입 시)</h4>
              <ul>
                <li>이름, 아이디, 비밀번호</li>
                <li>이메일, 전화번호</li>
                <li>주소(선택), 생년월일(선택), 성별(선택)</li>
                <li>서비스 이용 기록, 접속 로그, 쿠키, IP 정보</li>
              </ul>

              <h4>② 의사 회원 추가 수집 항목</h4>
              <ul>
                <li>면허번호</li>
                <li>전문의/진료과 정보</li>
                <li>소속 병원 정보</li>
                <li>의사 승인 여부 상태</li>
              </ul>

              <h4>③ 병원 정보 입력 시 수집 항목</h4>
              <ul>
                <li>병원명, 주소</li>
                <li>응급실 연락처</li>
                <li>병원 코드/HPID</li>
                <li>진료과 정보</li>
                <li>병원 위치 정보(lat, lng)</li>
              </ul>

              <h4>④ 환자 관련 정보(의료기록, 프로젝트용)</h4>
              <ul>
                <li>기본 인적사항(이름, 생년월일, 성별)</li>
                <li>환자 번호(차트번호)</li>
                <li>진료 기록, 처방, 검사 내역</li>
                <li>입원 정보</li>
                <li><strong>※ 실제 서비스에서는 의료법 및 개인정보보호법 등 관련 법령을 반드시 준수해야 합니다.</strong></li>
              </ul>

              <h3>3. 개인정보 보유 및 이용 기간</h3>
              <ul>
                <li>회원 탈퇴 시 지체 없이 개인정보를 삭제합니다.</li>
                <li>로그 기록(IP 포함)은 서비스 보안 및 운영 목적상 최대 1년 동안 보관할 수 있습니다.</li>
                <li>의료 관련 데이터(프로젝트용)는 프로젝트 종료 시 즉시 삭제합니다.</li>
              </ul>

              <h3>4. 개인정보의 제3자 제공</h3>
              <ul>
                <li>CareBridge는 원칙적으로 이용자의 개인정보를 제3자에게 제공하지 않습니다.</li>
                <li>다만, 다음의 경우 예외적으로 제공될 수 있습니다.
                  <ul>
                    <li>이용자가 사전에 동의한 경우</li>
                    <li>법령에 따라 제공 의무가 발생한 경우</li>
                    <li>병원·의사 기능 이용 시, 업무 목적 범위 내에서 담당 의사가 환자 정보를 조회하는 경우(내부 제공)</li>
                  </ul>
                </li>
              </ul>

              <h3>5. 개인정보 처리 위탁</h3>
              <ul>
                <li>현재 CareBridge는 개인정보 처리 업무를 외부 업체에 위탁하지 않습니다.</li>
                <li>향후 위탁이 발생하는 경우, 위탁 업체 및 위탁 업무 내용을 이용자에게 사전 고지 후 동의를 받겠습니다.</li>
              </ul>

              <h3>6. 이용자의 권리</h3>
              <ul>
                <li>이용자는 언제든지 자신의 개인정보에 대해 열람, 정정, 삭제, 처리 정지를 요청할 수 있습니다.</li>
                <li>동의 철회를 요청할 수 있으며, CareBridge는 지체 없이 필요한 조치를 취합니다.</li>
              </ul>

              <h3>7. 동의 거부 권리 및 그에 따른 불이익 안내</h3>
              <ul>
                <li>이용자는 개인정보 수집·이용에 대한 동의를 거부할 권리가 있습니다.</li>
                <li>다만, 필수 항목에 대한 동의를 거부하는 경우 서비스 이용이 제한될 수 있습니다.
                  <ul>
                    <li>예: 의사 인증 정보 미제공 시 의사 계정 활성화 불가</li>
                    <li>예: 필수 회원정보 미제공 시 회원가입 불가</li>
                  </ul>
                </li>
              </ul>

              <h3>8. 개인정보 보호 책임자</h3>
              <ul>
                <li>책임자: CareBridge 운영팀 (프로젝트용)</li>
                <li>이메일: support@carebridge.com</li>
              </ul>
            </div>

            <div class="terms-options">
              <label class="terms-option">
                <input type="radio" name="privacy_consent" value="agree" required>
                <span>개인정보 수집 동의.</span>
              </label>
              <label class="terms-option">
                <input type="radio" name="privacy_consent" value="disagree">
                <span>개인정보수집 및 이용에 동의 불가.</span>
              </label>
            </div>
          </div>
        </div>

        <!-- 작성자 정보 섹션 -->
        <div class="form-group" id="writer-info-group">
          <div class="writer-info-section">
            <div class="writer-info-item">
              <span class="writer-info-label">작성자</span>
              <div class="writer-info-value">
                <span class="writer-text" id="writer-name">{{ user.name }}</span>
              </div>
            </div>
            
            <div class="writer-info-item">
              <span class="writer-info-label">생년월일</span>
              <div class="writer-info-value">
                <span class="writer-text">{{ birth_date|default:'' }}</span>
              </div>
            </div>
            
            <div class="writer-info-item">
              <span class="writer-info-label">연락처</span>
              <div class="writer-info-value writer-phone-group">
                <span class="writer-text">{{ phone_parts.area|default:'' }}</span>
                <input type="hidden" name="phone_area" value="{{ phone_parts.area|default:'' }}">
                <span class="phone-separator">-</span>
                <span class="writer-text">{{ phone_parts.middle|default:'' }}</span>
                <span class="phone-separator">-</span>
                <span class="writer-text">{{ phone_parts.last|default:'' }}</span>
              </div>
            </div>
            
            <div class="writer-info-item">
              <span class="writer-info-label">이메일</span>
              <div class="writer-info-value writer-email-group">
                <span class="writer-text">{{ email_parts.username|default:'' }}</span>
                <span class="email-separator">@</span>
                {% if email_parts.domain and email_parts.domain != 'naver.com' and email_parts.domain != 'gmail.com' and email_parts.domain != 'daum.net' and email_parts.domain != 'kakao.com' %}
                <span class="writer-text">{{ email_parts.domain }}</span>
                <input type="hidden" name="email_domain" value="{{ email_parts.domain }}">
                {% else %}
                <span class="writer-text">{{ email_parts.domain|default:'' }}</span>
                <input type="hidden" name="email_domain" value="{{ email_parts.domain|default:'' }}">
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <div class="form-group form-content-group">
          <label for="title">제목</label>
          <input type="text" id="title" name="title" value="{{ title|default:'' }}" required class="form-input">
        </div>

        <div class="form-group form-content-group">
          <label for="content">내용</label>
          <textarea id="content" name="content" rows="10" required class="form-textarea">{{ content|default:'' }}</textarea>
        </div>

        <div class="form-group form-content-group">
          <label for="privacy">공개 설정</label>
          <div class="privacy-options">
            <label class="privacy-option">
              <input type="radio" name="privacy" value="PUBLIC" id="privacy-public" {% if privacy == 'PUBLIC' or not privacy %}checked{% endif %}>
              <span>공개</span>
            </label>
            <label class="privacy-option">
              <input type="radio" name="privacy" value="PRIVATE" id="privacy-private" {% if privacy == 'PRIVATE' %}checked{% endif %}>
              <span>비공개</span>
            </label>
          </div>
        </div>

        <div class="form-actions form-actions-group">
          <button type="submit" class="btn-submit">등록</button>
          <a href="{% url 'qna:qna_list' %}" class="btn-cancel">취소</a>
        </div>
      </form>
    </div>
  </main>

  {% include "core/footer.html" %}

  <script src="{% static 'qna/js/m_qna_common.js' %}"></script>
  <script src="{% static 'qna/js/m_qna_write.js' %}"></script>
</body>
</html>


