{% comment %}
  선택 의사 상세정보 템플릿
  
  목적: 의사 목록에서 선택된 의사의 상세 정보를 표시하는 템플릿
    - 사용자 경험(UX) 개선: 관리자가 의사 목록에서 의사를 선택하면 해당 의사의 상세 정보를 확인할 수 있도록 함
    - 데이터 표시: 의사의 기본 정보, 면허 정보, 병원 정보, 승인 상태 등을 그리드 레이아웃으로 표시
    - 상태 표시: 의사의 승인 상태를 시각적으로 표시 (승인/대기)
    - 개인정보 표시: 전화번호는 원본 그대로 표시
  
  동작 방식:
    1. selected_doctor 변수가 존재하는지 확인
    2. selected_doctor가 있으면 상세 정보 섹션 표시
    3. 의사의 각 정보 필드를 그리드 레이아웃으로 표시
    4. 전화번호는 원본 그대로 표시
    5. 승인 상태에 따라 다른 배지 표시 (승인/대기)
    6. 메모가 있으면 조건부로 표시
  
  사용 시점:
    - 의사 목록에서 의사를 선택했을 때 (AJAX로 로드)
    - 페이지 로드 시 URL 파라미터에 의사 ID가 있을 때
  
  관련 변수:
    - selected_doctor: 선택된 의사 객체 (Doctors 모델 인스턴스)
      → user: 의사의 사용자 정보 (Users 모델 인스턴스)
      → dep: 의사의 전공과 정보 (Departments 모델 인스턴스)
      → hos: 의사의 주근무 병원 정보 (Hospitals 모델 인스턴스)
      → verified: 의사의 승인 상태 (boolean)
      → memo: 의사에 대한 한줄 메모 (선택 사항)
{% endcomment %}
{% load masking_filters %}
{% if selected_doctor %}
{% comment %}
  상세 정보 섹션 컨테이너
  
  목적: 의사 상세 정보를 담는 컨테이너
    - CSS 클래스: user-detail-section (공통 스타일 적용)
    - 레이아웃: 상세 정보를 표시하는 섹션
{% endcomment %}
<div class="user-detail-section card shadow-sm">
  <div class="card-body">
    <h3 class="detail-title card-title border-bottom pb-3 mb-4">선택 의사 상세정보</h3>
    <div class="doctor-detail-grid">
    {% comment %}
      첫 번째 줄: 이름, 의사ID, 승인상태 (3열)
    {% endcomment %}
    <div class="doctor-detail-row doctor-detail-row-3">
      {% comment %} 이름 정보 항목 {% endcomment %}
      <div class="doctor-detail-col">
        <div class="detail-item">
          <span class="detail-label d-block fw-bold">이름</span>
          <div class="detail-value">{{ selected_doctor.user.name }}</div>
        </div>
      </div>
      
      {% comment %} 의사ID 정보 항목 {% endcomment %}
      <div class="doctor-detail-col">
        <div class="detail-item">
          <span class="detail-label d-block fw-bold">의사ID</span>
          <div class="detail-value">{{ selected_doctor.user.username|default:"-" }}</div>
        </div>
      </div>
      
      {% comment %} 승인상태 정보 항목 {% endcomment %}
      <div class="doctor-detail-col">
        <div class="detail-item">
          <span class="detail-label d-block fw-bold">승인상태</span>
          <div class="detail-value">
            {% if selected_doctor.verified %}
              <span class="status-badge status-approved">승인</span>
              {% if selected_doctor.user.created_at %}
                ({{ selected_doctor.user.created_at|date:"Y.m.d" }} 승인완료)
              {% endif %}
            {% else %}
              <span class="status-badge status-pending">대기</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    
    {% comment %}
      두 번째 줄: 면허번호, 주민번호 (2열)
    {% endcomment %}
    <div class="doctor-detail-row doctor-detail-row-2">
      {% comment %} 면허번호 정보 항목 {% endcomment %}
      <div class="doctor-detail-col">
        <div class="detail-item">
          <span class="detail-label d-block fw-bold">면허번호</span>
          <div class="detail-value">{{ selected_doctor.license_no }}</div>
        </div>
      </div>
      
      {% comment %} 
        주민번호 정보 항목
        
        목적: 의사의 주민번호를 표시 (하이픈 포함 형식)
          - detail-label: "주민번호" (라벨)
          - detail-value: 주민번호 포맷팅 처리
            → format_resident_reg_no 필터를 사용하여 "870513-1234567" 형식으로 표시
            → 예: "8705131234567" → "870513-1234567"
      {% endcomment %}
      <div class="doctor-detail-col">
        <div class="detail-item">
          <span class="detail-label d-block fw-bold">주민번호</span>
          <div class="detail-value">
            {{ selected_doctor.user.resident_reg_no|format_resident_reg_no }}
          </div>
        </div>
      </div>
    </div>
    
    {% comment %}
      세 번째 줄: 주근무 병원, 전공과 (2열)
    {% endcomment %}
    <div class="doctor-detail-row doctor-detail-row-2">
      {% comment %} 주근무 병원 정보 항목 {% endcomment %}
      <div class="doctor-detail-col">
        <div class="detail-item">
          <span class="detail-label d-block fw-bold">주근무 병원</span>
          <div class="detail-value">{{ selected_doctor.hos.name|default:"-" }}</div>
        </div>
      </div>
      
      {% comment %} 전공과 정보 항목 {% endcomment %}
      <div class="doctor-detail-col">
        <div class="detail-item">
          <span class="detail-label d-block fw-bold">전공과</span>
          <div class="detail-value">{{ selected_doctor.dep.dep_name|default:"-" }}</div>
        </div>
      </div>
    </div>
    
    {% comment %}
      네 번째 줄: 전화번호, 이메일 (2열)
    {% endcomment %}
    <div class="doctor-detail-row doctor-detail-row-2">
      {% comment %} 
        전화번호 정보 항목
        
        목적: 의사의 전화번호를 원본 그대로 표시
          - detail-label: "전화번호" (라벨)
          - detail-value: 전화번호 원본 표시 (마스킹 처리하지 않음)
      {% endcomment %}
      <div class="doctor-detail-col">
        <div class="detail-item">
          <span class="detail-label d-block fw-bold">전화번호</span>
          <div class="detail-value">{{ selected_doctor.user.phone|default:"-" }}</div>
        </div>
      </div>
      
      {% comment %} 이메일 정보 항목 {% endcomment %}
      <div class="doctor-detail-col">
        <div class="detail-item">
          <span class="detail-label d-block fw-bold">이메일</span>
          <div class="detail-value">{{ selected_doctor.user.email|default:"-" }}</div>
        </div>
      </div>
    </div>
    
    {% comment %}
      한줄 메모 정보 항목 (조건부 표시)
      
      목적: 의사에 대한 한줄 메모를 표시 (메모가 있는 경우에만 표시)
        - 조건: if selected_doctor.memo - 메모가 있는 경우에만 표시
        - CSS 클래스: detail-item full-width (전체 너비 항목 스타일)
          → full-width: 메모는 긴 텍스트일 수 있으므로 전체 너비로 표시
        - detail-label: "한줄 메모" (라벨)
        - detail-value: selected_doctor.memo (의사에 대한 메모)
          → memo: 의사에 대한 한줄 메모 (선택 사항)
    {% endcomment %}
    {% if selected_doctor.memo %}
    <div class="doctor-detail-row doctor-detail-row-1">
      <div class="doctor-detail-col">
        <div class="detail-item">
          <span class="detail-label d-block fw-bold">한줄 메모</span>
          <div class="detail-value">{{ selected_doctor.memo }}</div>
        </div>
      </div>
    </div>
    {% endif %}
    </div>
  </div>
</div>
{% endif %}
{% comment %}
  조건문 종료
  
  목적: selected_doctor가 없으면 상세 정보 섹션을 표시하지 않음
    - selected_doctor가 null이거나 없으면 아무것도 표시하지 않음
    - AJAX로 상세 정보를 로드할 때 사용
{% endcomment %}
