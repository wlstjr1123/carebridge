/**
 * 관리자 대시보드 - 7일 이용자 그래프 초기화
 * 
 * 목적: Chart.js를 사용하여 최근 7일간의 일일 방문자 수를 막대 그래프로 표시
 *   - 사용자 경험(UX) 개선: 시각적인 데이터 표현으로 방문자 추이를 쉽게 파악
 *   - 데이터 시각화: 템플릿에서 전달된 JSON 데이터를 파싱하여 차트 생성
 *   - 반응형 디자인: 화면 크기에 따라 차트 크기가 자동으로 조정됨
 * 
 * 동작 방식:
 *   1. DOM이 완전히 로드된 후 실행 (DOMContentLoaded 이벤트)
 *   2. 템플릿에서 전달된 JSON 데이터 요소 찾기
 *   3. JSON 문자열을 객체로 파싱
 *   4. 차트 캔버스 요소 찾기
 *   5. Chart.js를 사용하여 막대 그래프 생성 및 렌더링
 * 
 * 사용 시점:
 *   - 페이지 로드 시 (DOMContentLoaded 이벤트 발생 시)
 *   - 스크립트가 실행되기 전에 DOM이 준비되어 있어야 함
 * 
 * 관련 라이브러리:
 *   - Chart.js: 차트 라이브러리 (막대 그래프 생성)
 * 
 * 데이터 형식:
 *   - visitorData.labels: X축 레이블 배열 (날짜 목록)
 *   - visitorData.values: Y축 데이터 배열 (방문자 수 목록)
 * 
 * @example
 * // 자동 실행 (페이지 로드 시)
 * // 결과:
 * // 1. 최근 7일간의 일일 방문자 수를 막대 그래프로 표시
 * // 2. 반응형 차트로 화면 크기에 따라 자동 조정
 */
document.addEventListener('DOMContentLoaded', function() {
  // ========= 템플릿에서 전달된 데이터 요소 조회 =========
  // 목적: 템플릿에서 전달된 JSON 데이터를 담고 있는 요소를 찾기
  //   - 사용자 경험(UX) 개선: 서버에서 생성한 데이터를 클라이언트로 전달
  //   - 데이터 전달: Django 템플릿에서 JSON 데이터를 <script> 태그로 전달
  // 
  // document.getElementById('visitor-chart-data'): 데이터 요소 찾기
  //   - 'visitor-chart-data': 데이터 요소의 ID 속성
  //   - 반환값: HTMLElement 객체 또는 null (없으면)
  //   - 예: <script id="visitor-chart-data" type="application/json">{"labels": [...], "values": [...]}</script>
  //   - 목적: 템플릿에서 전달된 JSON 데이터를 읽기 위함
  //   - 주의: 이 요소는 Django 템플릿에서 생성되어야 함
  const visitorDataElement = document.getElementById('visitor-chart-data');
  
  // ========= 데이터 요소 존재 확인 및 데이터 파싱 =========
  // 목적: 데이터 요소가 존재하는 경우에만 차트 생성
  //   - 안전성: 데이터 요소가 없으면 에러 발생 방지
  //   - 데이터 무결성: 유효한 데이터가 있는 경우에만 차트 생성
  // 
  // if (visitorDataElement): 데이터 요소가 존재하는지 확인
  //   - visitorDataElement: 데이터 요소 (HTMLElement 객체) 또는 null
  //   - truthy 값이면 true (요소가 존재함)
  //   - falsy 값(null)이면 false (요소가 없음)
  //   - 목적: 데이터 요소가 있는 경우에만 차트 생성
  if (visitorDataElement) {
    // ========= JSON 문자열을 객체로 파싱 =========
    // 목적: 템플릿에서 전달된 JSON 문자열을 JavaScript 객체로 변환
    //   - 데이터 처리: 서버에서 전달된 JSON 문자열을 파싱하여 사용 가능한 형태로 변환
    //   - 사용자 경험(UX) 개선: 서버 데이터를 클라이언트에서 쉽게 사용 가능
    // 
    // JSON.parse(visitorDataElement.textContent): JSON 문자열을 객체로 파싱
    //   - JSON.parse(): JSON 문자열을 JavaScript 객체로 변환하는 메서드
    //   - visitorDataElement.textContent: 요소의 텍스트 내용 (JSON 문자열)
    //     → textContent: 요소의 텍스트 내용을 읽는 속성
    //     → 예: '{"labels": ["2024-01-01", ...], "values": [100, 150, ...]}'
    //   - 반환값: 파싱된 JavaScript 객체
    //     → 예: {labels: ["2024-01-01", ...], values: [100, 150, ...]}
    //   - 목적: 차트 생성에 필요한 데이터를 객체 형태로 변환
    //   - 주의: JSON 문자열이 유효하지 않으면 에러 발생
    const visitorData = JSON.parse(visitorDataElement.textContent);
    
    // ========= 차트 캔버스 요소 조회 =========
    // 목적: Chart.js가 렌더링할 캔버스 요소를 찾기
    //   - 사용자 경험(UX) 개선: 차트를 표시할 위치 지정
    // 
    // document.getElementById('visitorChart'): 차트 캔버스 요소 찾기
    //   - 'visitorChart': 캔버스 요소의 ID 속성
    //   - 반환값: HTMLCanvasElement 객체 또는 null (없으면)
    //   - 예: <canvas id="visitorChart"></canvas>
    //   - 목적: Chart.js가 차트를 렌더링할 캔버스 요소 찾기
    //   - 주의: 이 요소는 HTML 템플릿에 존재해야 함
    const ctx = document.getElementById('visitorChart');
    
    // ========= 캔버스 요소 존재 확인 및 차트 생성 =========
    // 목적: 캔버스 요소가 존재하는 경우에만 차트 생성
    //   - 안전성: 캔버스 요소가 없으면 에러 발생 방지
    //   - 데이터 무결성: 유효한 캔버스 요소가 있는 경우에만 차트 생성
    // 
    // if (ctx): 캔버스 요소가 존재하는지 확인
    //   - ctx: 캔버스 요소 (HTMLCanvasElement 객체) 또는 null
    //   - truthy 값이면 true (요소가 존재함)
    //   - falsy 값(null)이면 false (요소가 없음)
    //   - 목적: 캔버스 요소가 있는 경우에만 차트 생성
    if (ctx) {
      // ========= Chart.js를 사용하여 막대 그래프 생성 =========
      // 목적: Chart.js 라이브러리를 사용하여 막대 그래프 생성 및 렌더링
      //   - 사용자 경험(UX) 개선: 시각적인 데이터 표현으로 방문자 추이를 쉽게 파악
      //   - 데이터 시각화: 숫자 데이터를 그래프로 변환하여 직관적으로 표시
      // 
      // new Chart(ctx, {...}): Chart.js 인스턴스 생성
      //   - Chart: Chart.js 라이브러리의 생성자 함수
      //   - ctx: 차트를 렌더링할 캔버스 요소 (HTMLCanvasElement 객체)
      //   - 두 번째 인자: 차트 설정 객체
      //   - 반환값: Chart 인스턴스 객체
      //   - 동작: 차트를 생성하고 캔버스에 렌더링
      //   - 목적: 방문자 데이터를 막대 그래프로 표시
      new Chart(ctx, {
        // ========= 차트 타입 설정 =========
        // type: 'bar': 막대 그래프 타입 지정
        //   - 'bar': 막대 그래프 타입
        //   - Chart.js에서 지원하는 차트 타입 중 하나
        //   - 목적: 데이터를 막대 그래프로 표시
        //   - 사용자 경험(UX) 개선: 막대 그래프는 일일 데이터 비교에 적합
        type: 'bar',  // 막대 그래프 타입
        
        // ========= 차트 데이터 설정 =========
        // data: 차트에 표시할 데이터 설정
        //   - labels: X축 레이블 (날짜 목록)
        //   - datasets: 데이터셋 배열 (여러 데이터셋을 표시할 수 있음)
        data: {
          // ========= X축 레이블 설정 =========
          // labels: X축에 표시될 레이블 배열
          //   - visitorData.labels: 파싱된 데이터 객체의 labels 속성
          //     → 예: ["2024-01-01", "2024-01-02", "2024-01-03", ...]
          //   - 목적: X축에 날짜를 표시하여 각 막대가 어떤 날짜를 나타내는지 명확히 표시
          //   - 사용자 경험(UX) 개선: 날짜 정보를 제공하여 데이터를 쉽게 이해할 수 있음
          labels: visitorData.labels,  // X축 레이블 (날짜)
          
          // ========= 데이터셋 설정 =========
          // datasets: 차트에 표시할 데이터셋 배열
          //   - 배열 형태: 여러 데이터셋을 동시에 표시할 수 있음
          //   - 현재는 하나의 데이터셋만 사용 (일일 방문자 수)
          datasets: [{
            // ========= 데이터셋 레이블 설정 =========
            // label: 데이터셋의 이름 (범례에 표시될 이름)
            //   - '일일 방문자 수': 데이터셋의 이름
            //   - 목적: 사용자가 어떤 데이터를 보고 있는지 명확히 표시
            //   - 주의: 현재는 범례가 숨겨져 있어서 직접 표시되지 않음
            label: '일일 방문자 수',
            
            // ========= Y축 데이터 설정 =========
            // data: Y축에 표시될 데이터 배열 (방문자 수)
            //   - visitorData.values: 파싱된 데이터 객체의 values 속성
            //     → 예: [100, 150, 120, 180, 200, 170, 190]
            //   - 목적: 각 날짜별 방문자 수를 막대 그래프의 높이로 표시
            //   - 사용자 경험(UX) 개선: 숫자 데이터를 시각적으로 표현하여 추이를 쉽게 파악
            data: visitorData.values,  // Y축 데이터 (방문자 수)
            
            // ========= 막대 배경색 설정 =========
            // backgroundColor: 막대의 배경색 설정
            //   - 'rgba(0, 102, 204, 0.7)': RGBA 색상 값
            //     → 0, 102, 204: RGB 색상 (파란색)
            //     → 0.7: 알파 값 (투명도 70%, 불투명도 30%)
            //   - 목적: 막대 그래프의 배경색을 파란색으로 설정하고 약간의 투명도를 적용
            //   - 사용자 경험(UX) 개선: 시각적으로 보기 좋은 색상으로 설정
            backgroundColor: 'rgba(0, 102, 204, 0.7)',  // 막대 배경색
            
            // ========= 막대 테두리 색 설정 =========
            // borderColor: 막대의 테두리 색 설정
            //   - 'rgba(0, 102, 204, 1)': RGBA 색상 값
            //     → 0, 102, 204: RGB 색상 (파란색)
            //     → 1: 알파 값 (투명도 100%, 불투명)
            //   - 목적: 막대 그래프의 테두리 색을 배경색과 동일한 파란색으로 설정 (완전 불투명)
            //   - 사용자 경험(UX) 개선: 테두리로 막대의 경계를 명확히 표시
            borderColor: 'rgba(0, 102, 204, 1)',  // 막대 테두리 색
            
            // ========= 막대 테두리 두께 설정 =========
            // borderWidth: 막대의 테두리 두께 설정
            //   - 1: 테두리 두께 (픽셀 단위)
            //   - 목적: 막대 그래프의 테두리 두께를 1픽셀로 설정
            //   - 사용자 경험(UX) 개선: 적절한 테두리 두께로 시각적 구분 제공
            borderWidth: 1  // 테두리 두께
          }]
        },
        
        // ========= 차트 옵션 설정 =========
        // options: 차트의 동작 및 표시 옵션 설정
        //   - responsive: 반응형 차트 설정
        //   - maintainAspectRatio: 비율 유지 설정
        //   - plugins: 플러그인 설정 (범례 등)
        //   - scales: 축 설정 (Y축 등)
        options: {
          // ========= 반응형 차트 설정 =========
          // responsive: true: 차트를 반응형으로 설정
          //   - true: 차트 크기가 컨테이너 크기에 따라 자동으로 조정됨
          //   - 목적: 화면 크기에 따라 차트 크기가 자동으로 조정되도록 함
          //   - 사용자 경험(UX) 개선: 모바일, 태블릿, PC 등 다양한 화면 크기에서 최적화된 표시
          responsive: true,  // 반응형 차트
          
          // ========= 비율 유지 설정 =========
          // maintainAspectRatio: false: 차트의 비율을 유지하지 않음
          //   - false: 차트 비율을 유지하지 않고 컨테이너 크기에 맞춤
          //   - 목적: 컨테이너의 높이에 맞춰 차트 크기를 조정
          //   - 사용자 경험(UX) 개선: 컨테이너 크기에 맞춰 차트가 표시되어 공간 활용 최적화
          maintainAspectRatio: false,  // 비율 유지하지 않음 (컨테이너 크기에 맞춤)
          
          // ========= 플러그인 설정 =========
          // plugins: Chart.js 플러그인 설정
          //   - legend: 범례 설정
          plugins: {
            // ========= 범례 설정 =========
            // legend: 범례 표시 설정
            //   - display: false: 범례를 표시하지 않음
            //   - 목적: 데이터셋이 하나뿐이므로 범례가 불필요하여 숨김
            //   - 사용자 경험(UX) 개선: 불필요한 UI 요소를 제거하여 차트 영역 확대
            legend: {
              display: false  // 범례 숨김
            }
          },
          
          // ========= 축 설정 =========
          // scales: 차트의 축 설정
          //   - y: Y축 설정
          scales: {
            // ========= Y축 설정 =========
            // y: Y축 옵션 설정
            //   - beginAtZero: Y축이 0부터 시작하도록 설정
            //   - ticks: Y축 눈금 설정
            y: {
              // ========= Y축 시작점 설정 =========
              // beginAtZero: true: Y축이 0부터 시작하도록 설정
              //   - true: Y축의 최소값을 0으로 설정
              //   - 목적: 데이터의 상대적 크기를 정확하게 비교할 수 있도록 함
              //   - 사용자 경험(UX) 개선: 0부터 시작하여 데이터의 절대적 크기를 명확히 표시
              beginAtZero: true,  // Y축 0부터 시작
              
              // ========= Y축 눈금 설정 =========
              // ticks: Y축 눈금 옵션 설정
              //   - stepSize: 눈금 간격 설정
              ticks: {
                // ========= Y축 눈금 간격 설정 =========
                // stepSize: 50: Y축 눈금 간격을 50 단위로 설정
                //   - 50: 눈금 간격 (단위: 방문자 수)
                //   - 목적: Y축 눈금을 50 단위로 표시하여 가독성 향상
                //   - 사용자 경험(UX) 개선: 적절한 간격으로 눈금을 표시하여 데이터를 쉽게 읽을 수 있음
                //   - 예: 0, 50, 100, 150, 200, ... (50 단위로 표시)
                stepSize: 50  // Y축 눈금 간격 (50 단위)
              }
            }
          }
        }
      });
    }
    // 주의: ctx가 null이면 차트를 생성하지 않음 (에러 발생 안 함)
  }
  // 주의: visitorDataElement가 null이면 차트를 생성하지 않음 (에러 발생 안 함)
});









